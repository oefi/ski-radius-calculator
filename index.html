<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ski Radius Calculator</title>
    <style>
        :root {
            --bg-app: #0f172a;       /* Main Background */
            --bg-panel: #1e293b;     /* Sidebar/Cards */
            --primary: #38bdf8;      /* Active Edge Blue */
            --accent: #f43f5e;       /* Radius Red */
            --dim-length: #22c55e;   /* Green for Length */
            --dim-width: #fbbf24;    /* Yellow for Widths */
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- LEFT SIDEBAR --- */
        .sidebar {
            width: 380px;
            min-width: 340px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 25px;
            gap: 25px;
            overflow-y: auto;
            z-index: 20;
            box-shadow: 5px 0 25px rgba(0,0,0,0.5);
        }

        .header h1 { margin: 0; font-size: 1.4rem; color: var(--primary); letter-spacing: -0.5px; }
        .header p { margin: 5px 0 0 0; font-size: 0.85rem; color: var(--text-muted); }

        .section-title {
            font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em;
            color: var(--text-muted); border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 15px;
        }

        /* Control Cards */
        .card {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
        }

        .helper-text { font-size: 0.75rem; color: #64748b; margin-bottom: 12px; line-height: 1.4; font-style: italic; }

        /* Sliders & Inputs */
        .control-row { margin-bottom: 15px; }
        .control-row:last-child { margin-bottom: 0; }

        .label-row { display: flex; justify-content: space-between; margin-bottom: 6px; align-items: center; }
        .label-title { font-size: 0.85rem; font-weight: 500; color: #cbd5e1; display: flex; align-items: center; gap: 6px; }
        .label-val { font-family: 'Courier New', monospace; font-size: 0.95rem; font-weight: 700; color: var(--primary); }
        
        .dot-icon { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .dot-len { background: var(--dim-length); }
        .dot-wid { background: var(--dim-width); }

        input[type=range] {
            width: 100%; height: 5px; background: var(--border); border-radius: 3px;
            -webkit-appearance: none; cursor: pointer;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #fff; border: 2px solid var(--primary); margin-top: -5px;
            transition: transform 0.1s;
        }
        input[type=range]:active::-webkit-slider-thumb { transform: scale(1.2); }

        /* Profile Buttons */
        .btn-group { display: flex; gap: 8px; margin-bottom: 15px; }
        .btn {
            flex: 1; background: transparent; border: 1px solid var(--border);
            color: var(--text-muted); padding: 8px; border-radius: 6px;
            font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .btn:hover { background: rgba(255,255,255,0.05); }
        .btn.active { background: rgba(56, 189, 248, 0.15); border-color: var(--primary); color: var(--primary); }


        /* --- RIGHT MAIN PANEL --- */
        .main-panel {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 25px;
            gap: 20px;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
        }

        /* 1. Result Card */
        .result-card {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            flex-shrink: 0;
            min-height: 100px;
        }

        .result-block h2 { font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); margin: 0 0 5px 0; letter-spacing: 1px; }
        .result-block .big-val { font-size: 2.5rem; font-weight: 800; color: var(--accent); line-height: 1; }
        .result-block .sub-val { font-size: 0.9rem; color: #fff; font-weight: 600; margin-top: 5px; }

        .spectrum-bar {
            flex-grow: 1; margin: 0 40px; height: 8px;
            background: linear-gradient(90deg, #22c55e 0%, #3b82f6 50%, #f43f5e 100%);
            border-radius: 4px; position: relative;
        }
        .marker {
            width: 16px; height: 16px; background: #fff; border: 3px solid var(--bg-app);
            border-radius: 50%; position: absolute; top: -4px; transform: translateX(-50%);
            transition: left 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            box-shadow: 0 0 8px rgba(0,0,0,0.5);
        }
        .spectrum-labels {
            display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.7rem; color: var(--text-muted); font-weight: 600;
        }

        /* 2. Visualization Card */
        .vis-card {
            flex-grow: 1;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--border);
            border-radius: 12px;
            position: relative;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
        }
        
        .vis-header {
            position: absolute; top: 15px; left: 20px; z-index: 10;
            font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted);
        }

        .canvas-wrapper {
            flex-grow: 1;
            width: 100%;
            height: 100%; /* Important: Fill container */
            position: relative;
        }
        
        canvas { display: block; width: 100%; height: 100%; }

        .legend {
            position: absolute; bottom: 15px; right: 20px;
            display: flex; gap: 15px;
            background: rgba(15, 23, 42, 0.8); padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border);
        }
        .l-item { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: #cbd5e1; }
        .l-dot { width: 8px; height: 8px; border-radius: 50%; }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="header">
            <h1>Ski Radius Calculator</h1>
            <p>Geometry Calculator</p>
        </div>

        <div class="section-title">1. Calibration (Effective Edge)</div>
        <div class="card">
            <div class="helper-text">
                Select your ski type to estimate contact length.
            </div>
            <div class="btn-group">
                <button class="btn active" id="btn-piste" onclick="setPreset(0.91, 'btn-piste')">Piste (91%)</button>
                <button class="btn" id="btn-all" onclick="setPreset(0.87, 'btn-all')">All-Mtn (87%)</button>
                <button class="btn" id="btn-pow" onclick="setPreset(0.75, 'btn-pow')">Powder (75%)</button>
            </div>
            <div class="control-row">
                <div class="label-row">
                    <span class="label-title">Manual Adjustment</span>
                    <span class="label-val" id="txt-F">91%</span>
                </div>
                <input type="range" id="in-F" min="70" max="100" value="91" oninput="manualFactor()">
            </div>
        </div>

        <div class="section-title" style="margin-top:20px;">2. Dimensions</div>
        <div class="card">
            <div class="control-row">
                <div class="label-row">
                    <span class="label-title"><span class="dot-icon dot-len"></span> Total Length (cm)</span>
                    <span class="label-val" id="txt-L">166</span>
                </div>
                <input type="range" id="in-L" min="140" max="200" value="166" oninput="update()">
            </div>
            
            <hr style="border: 0; border-top: 1px solid var(--border); margin: 15px 0;">

            <div class="control-row">
                <div class="label-row">
                    <span class="label-title"><span class="dot-icon dot-wid"></span> Tip Width (mm)</span>
                    <span class="label-val" id="txt-T">120</span>
                </div>
                <input type="range" id="in-T" min="100" max="160" value="120" oninput="update()">
            </div>

            <div class="control-row">
                <div class="label-row">
                    <span class="label-title"><span class="dot-icon dot-wid"></span> Waist Width (mm)</span>
                    <span class="label-val" id="txt-W">69</span>
                </div>
                <input type="range" id="in-W" min="60" max="110" value="69" oninput="update()">
            </div>

            <div class="control-row">
                <div class="label-row">
                    <span class="label-title"><span class="dot-icon dot-wid"></span> Tail Width (mm)</span>
                    <span class="label-val" id="txt-H">102</span>
                </div>
                <input type="range" id="in-H" min="90" max="140" value="102" oninput="update()">
            </div>
        </div>
    </div>

    <div class="main-panel">
        
        <div class="result-card">
            <div class="result-block">
                <h2>Calculated Radius</h2>
                <div class="big-val" id="out-radius">--</div>
            </div>
            
            <div class="spectrum-bar">
                <div class="marker" id="spectrum-marker"></div>
                <div class="spectrum-labels" style="position: absolute; width: 100%; top: 12px;">
                    <span>Slalom (<13m)</span>
                    <span>All-Round</span>
                    <span>GS (>18m)</span>
                </div>
            </div>

            <div class="result-block" style="text-align: right;">
                <h2>Classification</h2>
                <div class="sub-val" id="out-class">--</div>
            </div>
        </div>

        <div class="vis-card">
            <div class="vis-header">Real-Time Blueprint</div>
            
            <div class="canvas-wrapper" id="canvasContainer">
                <canvas id="skiCanvas"></canvas>
            </div>

            <div class="legend">
                <div class="l-item"><span class="l-dot" style="background: #334155"></span>Structure</div>
                <div class="l-item"><span class="l-dot" style="background: var(--primary)"></span>Active Edge</div>
                <div class="l-item"><span class="l-dot" style="background: var(--accent)"></span>Sidecut Arc</div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('skiCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('canvasContainer');

        // State
        let ski = { L: 166, T: 120, W: 69, H: 102, Factor: 0.91 };

        function setPreset(val, btnId) {
            ski.Factor = val;
            document.getElementById('in-F').value = val * 100;
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            document.getElementById(btnId).classList.add('active');
            update();
        }

        function manualFactor() {
            ski.Factor = document.getElementById('in-F').value / 100;
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
            update();
        }

        function update() {
            ski.L = parseInt(document.getElementById('in-L').value);
            ski.T = parseInt(document.getElementById('in-T').value);
            ski.W = parseInt(document.getElementById('in-W').value);
            ski.H = parseInt(document.getElementById('in-H').value);

            // Update Labels
            document.getElementById('txt-L').innerText = ski.L;
            document.getElementById('txt-T').innerText = ski.T;
            document.getElementById('txt-W').innerText = ski.W;
            document.getElementById('txt-H').innerText = ski.H;
            document.getElementById('txt-F').innerText = Math.round(ski.Factor * 100) + "%";

            // Math
            const effLengthM = (ski.L * ski.Factor) / 100;
            const avgWidthMM = (ski.T + ski.H) / 2;
            const sidecutDepthMM = (avgWidthMM - ski.W) / 2;
            const sidecutDepthM = sidecutDepthMM / 1000;

            let radius = 0;
            if (sidecutDepthM > 0) radius = (effLengthM * effLengthM) / (8 * sidecutDepthM);

            // Output Results
            const rFixed = radius.toFixed(1);
            document.getElementById('out-radius').innerText = (sidecutDepthM > 0) ? rFixed + "m" : "N/A";

            // Update Class & Spectrum
            updateSpectrum(radius);

            // Draw
            requestAnimationFrame(draw);
        }

        function updateSpectrum(r) {
            const marker = document.getElementById('spectrum-marker');
            const label = document.getElementById('out-class');
            
            // Map 10m-24m to 0-100%
            let pct = ((r - 10) / (24 - 10)) * 100;
            if (pct < 0) pct = 0;
            if (pct > 100) pct = 100;
            marker.style.left = pct + "%";

            if (r < 13.5) label.innerText = "Slalom / Short Turn";
            else if (r < 17.5) label.innerText = "All-Round / Carver";
            else if (r < 23) label.innerText = "Giant Slalom (GS)";
            else label.innerText = "Super-G / Long Turn";
        }

        function draw() {
            const dpr = window.devicePixelRatio || 1;
            const rect = container.getBoundingClientRect();
            
            if (canvas.width !== rect.width * dpr || canvas.height !== rect.height * dpr) {
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
            }
            
            ctx.setTransform(1, 0, 0, 1, 0, 0); 
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, rect.width, rect.height);

            const cx = rect.width / 2;
            const cy = rect.height / 2;

            // --- SMART SCALING (FIT CONTAIN) ---
            // Calculate a unified scale factor that respects both Width and Height constraints.
            // A real ski is approx 170cm x 12cm. Very tall, very thin.
            // We need to fit 'ski.L' into container height, AND 'ski.T' (with exaggeration) into container width.
            
            const padding = 60; // Space for labels
            const availHeight = rect.height - (padding * 2);
            const availWidth = rect.width - (padding * 2);
            
            // Width exaggeration factor (visual only)
            const widthExaggeration = 3.5;

            // Determine pixels per cm based on HEIGHT constraint first
            let pxPerCm = availHeight / ski.L;
            
            // Check if WIDTH constraint is violated (unlikely but possible on narrow screens)
            const maxSkiWidthPx = (ski.T / 10) * pxPerCm * widthExaggeration;
            if (maxSkiWidthPx > availWidth) {
                // If too wide, scale down based on width
                pxPerCm = availWidth / ((ski.T / 10) * widthExaggeration);
            }

            // --- CALCULATE COORDINATES ---
            
            const totalH_px = ski.L * pxPerCm;
            const effH_px = (ski.L * ski.Factor) * pxPerCm;
            
            // Y Coords (Centered)
            const startY_eff = cy - (effH_px / 2);
            const endY_eff = cy + (effH_px / 2);

            const rockerLen_px = totalH_px - effH_px;
            const tipLen_px = rockerLen_px * 0.6; 
            const tailLen_px = rockerLen_px * 0.4;
            const startY_total = startY_eff - tipLen_px;
            const endY_total = endY_eff + tailLen_px;

            // X Widths
            const tipW_px = (ski.T / 10) * pxPerCm * widthExaggeration;
            const waistW_px = (ski.W / 10) * pxPerCm * widthExaggeration;
            const tailW_px = (ski.H / 10) * pxPerCm * widthExaggeration;

            // --- DRAW LAYERS ---

            // 1. Structure (Grey)
            ctx.fillStyle = "#334155";
            drawRealSkiShape(ctx, cx, cy, startY_total, endY_total, startY_eff, endY_eff, tipW_px, waistW_px, tailW_px, true);
            ctx.fill();

            // 2. Active Edge (Blue)
            ctx.fillStyle = "#38bdf8";
            drawRealSkiShape(ctx, cx, cy, startY_total, endY_total, startY_eff, endY_eff, tipW_px, waistW_px, tailW_px, false);
            ctx.fill();

            // 3. Binding/Mount Point (Black Box)
            const bindW = waistW_px * 1.2;
            const bindH = totalH_px * 0.05; // Proportional binding size
            ctx.fillStyle = "#0f172a";
            ctx.beginPath();
            ctx.roundRect(cx - bindW/2, cy - bindH/2, bindW, bindH, 4);
            ctx.fill();
            ctx.strokeStyle = "#475569"; ctx.lineWidth = 1; ctx.stroke();

            // 4. Color-Coded Measurements
            drawMeasurements(ctx, cx, startY_total, endY_total, cy, tipW_px, waistW_px, tailW_px);
        }

        // Helper to draw ski curve
        function drawRealSkiShape(ctx, cx, cy, yTop, yBottom, yContactTop, yContactBottom, wTip, wWaist, wTail, isStructure) {
            ctx.beginPath();
            if (isStructure) {
                // Rounded Tip
                ctx.moveTo(cx - wTip/2, yContactTop);
                ctx.bezierCurveTo(cx - wTip/2, yTop, cx + wTip/2, yTop, cx + wTip/2, yContactTop);
            } else {
                ctx.moveTo(cx - wTip/2, yContactTop);
                ctx.lineTo(cx + wTip/2, yContactTop);
            }

            // Sidecut curve down to waist then tail
            ctx.quadraticCurveTo(cx + wWaist/2 - (wTip-wWaist)*0.1, cy, cx + wTail/2, yContactBottom);

            if (isStructure) {
                // Rounded Tail
                ctx.bezierCurveTo(cx + wTail/2, yBottom, cx - wTail/2, yBottom, cx - wTail/2, yContactBottom);
            } else {
                ctx.lineTo(cx - wTail/2, yContactBottom);
            }
            
            // Sidecut back up
            ctx.quadraticCurveTo(cx - wWaist/2 + (wTip-wWaist)*0.1, cy, cx - wTip/2, yContactTop);
            ctx.closePath();
        }

        function drawMeasurements(ctx, cx, yTop, yBottom, yMid, wTip, wWaist, wTail) {
            ctx.lineWidth = 1;
            ctx.font = "bold 11px sans-serif";
            ctx.textAlign = "center";

            // Length Line (Green)
            const xOffset = cx - wTip/2 - 60; // Move further left
            ctx.strokeStyle = "#22c55e"; // Green
            ctx.fillStyle = "#22c55e";
            
            ctx.beginPath();
            ctx.moveTo(xOffset, yTop);
            ctx.lineTo(xOffset, yBottom);
            // End caps
            ctx.moveTo(xOffset-5, yTop); ctx.lineTo(xOffset+5, yTop);
            ctx.moveTo(xOffset-5, yBottom); ctx.lineTo(xOffset+5, yBottom);
            ctx.stroke();
            
            // Rotate text for length
            ctx.save();
            ctx.translate(xOffset - 15, yMid);
            ctx.rotate(-Math.PI/2);
            ctx.fillText(ski.L + "cm", 0, 0);
            ctx.restore();

            // Width Lines (Yellow)
            ctx.strokeStyle = "#fbbf24"; // Yellow
            ctx.fillStyle = "#fbbf24";

            // Tip Width
            drawDimLine(ctx, cx, yTop + 20, wTip, ski.T);
            // Waist Width
            drawDimLine(ctx, cx, yMid, wWaist, ski.W);
            // Tail Width
            drawDimLine(ctx, cx, yBottom - 20, wTail, ski.H);

            // Sidecut Depth Arc (Red) - Right Side
            ctx.strokeStyle = "#f43f5e";
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            const arcX = cx + wTip/2 + 50; // Move further right
            ctx.moveTo(arcX, yTop + 40); // Start near tip contact
            ctx.quadraticCurveTo(cx + wWaist/2 + 30, yMid, arcX, yBottom - 40); // Curve inward toward waist
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = "#f43f5e";
            ctx.textAlign = "left";
            ctx.fillText("RADIUS ARC", arcX + 5, yMid);
        }

        function drawDimLine(ctx, cx, y, pxWidth, val) {
            ctx.beginPath();
            ctx.moveTo(cx - pxWidth/2, y);
            ctx.lineTo(cx + pxWidth/2, y);
            ctx.stroke();
            // Background for text readability
            ctx.fillStyle = "rgba(15, 23, 42, 0.9)";
            ctx.fillRect(cx - 20, y - 6, 40, 12);
            ctx.fillStyle = "#fbbf24";
            ctx.fillText(val, cx, y + 4);
        }

        window.addEventListener('resize', () => requestAnimationFrame(draw));
        window.addEventListener('load', update);

    </script>
</body>
</html>

